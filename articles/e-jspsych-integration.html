<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial (expert): jsPsych integration • psychTestR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial (expert): jsPsych integration">
<meta property="og:description" content="psychTestR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">psychTestR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.20.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a1-simple-demo.html">Demos</a>
    </li>
    <li>
      <a href="../articles/a2-research-examples.html">Research examples</a>
    </li>
    <li>
      <a href="../articles/b-introduction.html">An introduction to psychTestR</a>
    </li>
    <li>
      <a href="../articles/c-media-files.html">Tutorial (basic): Media files</a>
    </li>
    <li>
      <a href="../articles/c-modularisation.html">Tutorial (basic): Modularisation</a>
    </li>
    <li>
      <a href="../articles/d-automated-testing.html">Tutorial (intermediate): Automated testing</a>
    </li>
    <li>
      <a href="../articles/d-building-custom-page-types.html">Tutorial (intermediate): Building custom page types</a>
    </li>
    <li>
      <a href="../articles/d-editing-dictionaries.html">Tutorial (intermediate): Editing dictionaries</a>
    </li>
    <li>
      <a href="../articles/d-hosting-experiments-online.html">Tutorial (intermediate): Hosting experiments online</a>
    </li>
    <li>
      <a href="../articles/d-randomisation.html">Tutorial (intermediate): Randomising item administration</a>
    </li>
    <li>
      <a href="../articles/d-url-parameters.html">Tutorial (intermediate): URL parameters</a>
    </li>
    <li>
      <a href="../articles/e-internationalised-questionnaire.html">Tutorial (expert): Creating an internationalised questionnaire</a>
    </li>
    <li>
      <a href="../articles/e-jspsych-integration.html">Tutorial (expert): jsPsych integration</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pmcharrison/psychTestR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial (expert): jsPsych integration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pmcharrison/psychTestR/blob/master/vignettes/e-jspsych-integration.Rmd"><code>vignettes/e-jspsych-integration.Rmd</code></a></small>
      <div class="hidden name"><code>e-jspsych-integration.Rmd</code></div>

    </div>

    
    
<div id="about" class="section level2">
<h2 class="hasAnchor">
<a href="#about" class="anchor"></a>About</h2>
<p><a href="https://www.jspsych.org/">jsPsych</a> is a powerful library for constructing behavioral experiments in Javascript. It is possible to embed jsPsych within psychTestR. This is useful when you want to take advantage of jsPsych’s timed stimulus presentation facilities.</p>
</div>
<div id="compatibility-notes" class="section level2">
<h2 class="hasAnchor">
<a href="#compatibility-notes" class="anchor"></a>Compatibility notes</h2>
<p>This tutorial was written with reference to jsPsych 6.1.0. Unfortunately the jsPsych API is subject to change, which means that the code provided in this tutorial may need some editing to work with future versions of jsPsych. Please contact the package maintainer if you notice problems along these lines.</p>
</div>
<div id="tutorial" class="section level2">
<h2 class="hasAnchor">
<a href="#tutorial" class="anchor"></a>Tutorial</h2>
<p>Normally we create a jsPsych test by writing an HTML file. Here is the ‘Hello World’ example from the <a href="https://www.jspsych.org/tutorials/hello-world/">jsPsych website</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">        <span class="kw">&lt;title&gt;</span>My experiment<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">"jspsych-6.1.0/jspsych.js"</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">"jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">        <span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">"jspsych-6.1.0/css/jspsych.css"</span><span class="ot"> rel=</span><span class="st">"stylesheet"</span><span class="ot"> type=</span><span class="st">"text/css"</span><span class="kw">&gt;&lt;/link&gt;</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">    <span class="kw">&lt;body&gt;&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    <span class="kw">&lt;script&gt;</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">    <span class="kw">var</span> hello_trial <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">        <span class="dt">type</span><span class="op">:</span> <span class="st">'html-keyboard-response'</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">        <span class="dt">stimulus</span><span class="op">:</span> <span class="st">'Hello world!'</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">    <span class="op">}</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    <span class="va">jsPsych</span>.<span class="at">init</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">        <span class="dt">timeline</span><span class="op">:</span> [hello_trial]</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-20" data-line-number="20"></a>
<a class="sourceLine" id="cb1-21" data-line-number="21">    <span class="kw">&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<p>We’re going to get this example running in psychTestR. The first step is to download the jsPsych source code from the <a href="https://github.com/jspsych/jsPsych/releases">GitHub repository</a>, unzip the release file, and save the resulting directory as a subdirectory of your current working directory, called for example <code>jspsych-6.1.0</code>.</p>
<p>To incorporate this code into psychTestR, we first create a file called <code>new-timeline.js</code>, where we define a function that creates a jsPsych timeline.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">function</span> <span class="at">new_timeline</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw">var</span> hello_trial <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="dt">type</span><span class="op">:</span> <span class="st">'html-keyboard-response'</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    <span class="dt">stimulus</span><span class="op">:</span> <span class="st">'Hello world!'</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="op">};</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="cf">return</span> [hello_trial]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="op">}</span></a></code></pre></div>
<p>We then make a second Javascript file, <code>run-jspsych.js</code>, containing the following boilerplate code:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">function</span> <span class="at">run_jspsych</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="va">jsPsych</span>.<span class="at">init</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="dt">timeline</span><span class="op">:</span> <span class="at">new_timeline</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="dt">display_element</span><span class="op">:</span> <span class="st">'js_psych'</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">      <span class="kw">var</span> json_data <span class="op">=</span> <span class="va">jsPsych</span>.<span class="va">data</span>.<span class="at">get</span>().<span class="at">json</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">      <span class="va">Shiny</span>.<span class="at">onInputChange</span>(<span class="st">"jspsych_results"</span><span class="op">,</span> json_data)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">      <span class="at">next_page</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="at">run_jspsych</span>()<span class="op">;</span></a></code></pre></div>
<p>Finally, we create an R file called <code>my-test.R</code>, and define a psychTestR page that wraps the jsPsych test. We do this using helper functions from the <code>htmltools</code> package, which allow us to build HTML code programmatically from within R.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">htmltools</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">psychTestR</span>)

<span class="no">jspsych_dir</span> <span class="kw">&lt;-</span> <span class="st">"jspsych-6.1.0"</span>

<span class="no">head</span> <span class="kw">&lt;-</span> <span class="no">tags</span>$<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/include.html">includeScript</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">jspsych_dir</span>, <span class="st">"jspsych.js"</span>)),
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/include.html">includeScript</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">jspsych_dir</span>, <span class="st">"plugins/jspsych-html-keyboard-response.js"</span>))
)

<span class="no">ui</span> <span class="kw">&lt;-</span> <span class="no">tags</span>$<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span>(
  <span class="no">head</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/include.html">includeScript</a></span>(<span class="st">"new-timeline.js"</span>),
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/include.html">includeScript</a></span>(<span class="st">"run-jspsych.js"</span>),
  <span class="no">tags</span>$<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"js_psych"</span>)
)

<span class="no">hello_world</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/page.html">page</a></span>(
  <span class="kw">ui</span> <span class="kw">=</span> <span class="no">ui</span>,
  <span class="kw">label</span> <span class="kw">=</span> <span class="st">"hello_world"</span>,
  <span class="kw">get_answer</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">input</span>, <span class="no">...</span>) <span class="no">input</span>$<span class="no">jspsych_results</span>,
  <span class="kw">validate</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">answer</span>, <span class="no">...</span>) <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span>(<span class="no">answer</span>) <span class="kw">&gt;</span> <span class="fl">0L</span>,
  <span class="kw">save_answer</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)</pre></body></html></div>
<p>We can then run this as a full psychTestR test by adding the following code to <code>my-test.R</code>:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">elts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="fu"><a href="../reference/one_button_page.html">one_button_page</a></span>(<span class="st">"You are about to take the 'Hello world' test."</span>),
  <span class="fu"><a href="../reference/one_button_page.html">one_button_page</a></span>(<span class="st">"When you see 'Hello world', press SPACE to continue."</span>),
  <span class="no">hello_world</span>,
  <span class="fu"><a href="../reference/elt_save_results_to_disk.html">elt_save_results_to_disk</a></span>(<span class="kw">complete</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="fu"><a href="../reference/final_page.html">final_page</a></span>(<span class="st">"You finished the test."</span>)
)

<span class="no">test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/make_test.html">make_test</a></span>(
  <span class="kw">elts</span> <span class="kw">=</span> <span class="no">elts</span>,
  <span class="kw">opt</span> <span class="kw">=</span> <span class="fu"><a href="../reference/demo_options.html">demo_options</a></span>(
    <span class="kw">display</span> <span class="kw">=</span> <span class="fu"><a href="../reference/display_options.html">display_options</a></span>(
      <span class="kw">fullscreen</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
      <span class="kw">css</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">jspsych_dir</span>, <span class="st">"css/jspsych.css"</span>))
  ))

<span class="kw pkg">shiny</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/runApp.html">runApp</a></span>(<span class="no">test</span>)</pre></body></html></div>
<p>Note that we’ve added two display options:</p>
<ul>
<li>
<code>full_screen = TRUE</code> sets the test to display in fullscreen, to reflect the default display configuration of jsPsych.</li>
<li>
<code>css = file.path(jspsych_dir, "css/jspsych.css")</code> tells psychTestR to incorporate the default jsPsych style sheet. You can provide multiple CSS files to this argument if you wish to incorporate your own CSS styling.</li>
</ul>
<p>We can now inspect the test results by loading the generated RDS file in <code>output/results/</code>. You can do this by clicking on the file in the RStudio viewer, or by using the <code>readRDS</code> function. Using the function <code><a href="https://rdrr.io/r/base/list.html">as.list()</a></code> to coerce the results file to a readable format, we can see that the jsPsych output has been saved as a JSON string in the slot <code>$results$hello_world</code>.</p>
<p>This proof of concept should extend naturally to more sophisticated jsPsych tests. In particular, you will want to extend <code>new-timeline.js</code> to provide a timeline that describes your desired experimental structure. You can also extend <code>run-jspsych.js</code> to incorporate various options that you would normally pass to <code>jsPsych.init()</code>, as well as passing additional CSS files to <code>display_options</code>. Good luck! Please contact the package maintainer if you encounter any issues.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter M. C. Harrison.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
