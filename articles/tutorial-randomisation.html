<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial: Randomising item administration • psychTestR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial: Randomising item administration">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">psychTestR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/editing-dictionaries.html">Editing dictionaries</a>
    </li>
    <li>
      <a href="../articles/hosting-experiments-online.html">Hosting experiments online</a>
    </li>
    <li>
      <a href="../articles/jspsych-integration.html">Tutorial: jsPsych integration</a>
    </li>
    <li>
      <a href="../articles/tutorial-internationalised-questionnaire.html">Tutorial: Creating an internationalised questionnaire</a>
    </li>
    <li>
      <a href="../articles/tutorial-randomisation.html">Tutorial: Randomising item administration</a>
    </li>
    <li>
      <a href="../articles/url-parameters.html">URL parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pmcharrison/psychTestR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tutorial: Randomising item administration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pmcharrison/psychTestR/blob/master/vignettes/tutorial-randomisation.Rmd"><code>vignettes/tutorial-randomisation.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial-randomisation.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>This tutorial addresses the common task of randomising the order in which items are administered to participants. Such techniques can be useful for avoiding order effects.</p>
<p>In the simplest randomisation scheme, every participant receives the same set of items, and the order of these items is randomly permuted for each participant. However, many experiments require more sophisticated randomisation schemes, for example:</p>
<ul>
<li>Choosing only short questions if the participant says they have a train to catch;</li>
<li>Using the participant’s initials as the seed for the randomisation algorithm;</li>
<li>Ensuring that each item is administered the same number of times across participants.</li>
</ul>
<p>psychTestR does not limit the researcher to specific randomisation schemes, but instead encourages arbitrary randomisation schemes to be defined through R code, as described below.</p>
</div>
<div id="tutorial" class="section level2">
<h2 class="hasAnchor">
<a href="#tutorial" class="anchor"></a>Tutorial</h2>
<p>Suppose we wish to administer the three survey items, each with a yes or no response:</p>
<ol style="list-style-type: decimal">
<li>Are you afraid of dogs?</li>
<li>Are you afraid of birds?</li>
<li>Are you afraid of heights?</li>
</ol>
<p>We can code these three items as a <em>tibble</em>:<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(psychTestR)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tibble)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">items &lt;-<span class="st"> </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  <span class="op">~</span><span class="st"> </span>id,       <span class="op">~</span><span class="st"> </span>prompt,</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="st">"dogs"</span>,    <span class="st">"Are you afraid of dogs?"</span>,</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="st">"birds"</span>,   <span class="st">"Are you afraid of birds?"</span>,</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  <span class="st">"heights"</span>, <span class="st">"Are you afraid of heights?"</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">items</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   id      prompt                    
##   &lt;chr&gt;   &lt;chr&gt;                     
## 1 dogs    Are you afraid of dogs?   
## 2 birds   Are you afraid of birds?  
## 3 heights Are you afraid of heights?</code></pre>
<p>There are three items in total, corresponding to the three rows of <code>items</code>. We want each participant to receive these three items in a random order, with this random order freshly determined for each participant.</p>
<p>To achieve this, we define a <em>code block</em>, which will be run once for each participant, to determine the participant’s randomisation order.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">num_items &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(items)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">init_randomiser &lt;-<span class="st"> </span><span class="kw"><a href="../reference/code_block.html">code_block</a></span>(<span class="cf">function</span>(state, ...) {</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  item_order &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="dt">x =</span> num_items, </a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                       <span class="dt">size =</span> num_items,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">                       <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  <span class="kw"><a href="../reference/save_result.html">save_result</a></span>(<span class="dt">place =</span> state, </a>
<a class="sourceLine" id="cb3-8" data-line-number="8">              <span class="dt">label =</span> <span class="st">"item_order"</span>, </a>
<a class="sourceLine" id="cb3-9" data-line-number="9">              <span class="dt">value =</span> item_order)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="kw"><a href="../reference/global_local.html">set_local</a></span>(<span class="dt">key =</span> <span class="st">"item_order"</span>,</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">            <span class="dt">value =</span> item_order,</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">            <span class="dt">state =</span> state)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">})</a></code></pre></div>
<p>A code block is a piece of R code that runs during the participant’s testing session. This particular code block comprises three functions: <code>sample</code>, <code>save_result</code>, and <code>set_local</code>.</p>
<ol style="list-style-type: decimal">
<li>The <code>sample</code> function generates a random item order. Here it samples from the integers from 1 to <code>num_items</code>, taking <code>num_items</code> such samples without replacement. This corresponds to a random permutation of the integers from 1 to <code>num_items</code>.</li>
<li>The <code>save_result</code> function saves the resulting randomisation order to the participant’s results list.</li>
<li>The <code>set_local</code> function stores the item order as a local variable so that it can easily be accessed in later parts of the testing session.</li>
</ol>
<p>Next we write a function that programmatically generates test pages. This function takes two inputs: <code>id</code> and <code>prompt</code>, corresponding to the two columns of <code>items</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">item &lt;-<span class="st"> </span><span class="cf">function</span>(id, prompt) {</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="kw"><a href="../reference/NAFC_page.html">NAFC_page</a></span>(</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    <span class="dt">label =</span> id,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    <span class="dt">prompt =</span> prompt, </a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="dt">choices =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>),</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    <span class="dt">on_complete =</span> <span class="cf">function</span>(state, ...) {</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">      <span class="kw"><a href="../reference/global_local.html">set_local</a></span>(<span class="st">"item_pos"</span>, </a>
<a class="sourceLine" id="cb4-8" data-line-number="8">                1L <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/global_local.html">get_local</a></span>(<span class="st">"item_pos"</span>, state),</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">                state)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">    })</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">}</a></code></pre></div>
<p>The code above describes a simple two-alternative forced choice page, where the participant has to respond ‘Yes’ or ‘No’. Once the page has finished, the <code>on_complete</code> function increments the local variable <code>item_pos</code> by 1. This variable, <code>item_pos</code>, will track how far the participant is through the test.</p>
<p>Now we write the code for showing the items to the participant. This code comprises two sections: an initial code block, followed by a while loop. The starting code block initialises the local variable <code>item_pos</code> to 1, signifying the fact that the participant is about to take the first test item.</p>
<p>The while loop, meanwhile, is defined with two arguments: <code>test</code> and <code>logic</code>.</p>
<ul>
<li>The <code>test</code> argument describes a function that is evaluated to determine whether to administer the test elements described in <code>logic</code>. Here the <code>test</code> function checks whether the <code>item_pos</code> local variable is less than or equal to the total number of items in the test; if so, then another item should be administered.</li>
<li>The <code>logic</code> argument takes the form of a <em>reactive page</em>. A reactive page is a page whose content depends on variables generated during the participant’s testing session, in this case <code>item_pos</code> and <code>item_order</code>. The reactive page defined here refers to these local variables, looks up the appropriate item in <code>items</code>, and then generates the required page with the <code>item</code> function.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">show_items &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="kw"><a href="../reference/code_block.html">code_block</a></span>(<span class="cf">function</span>(state, ...) <span class="kw"><a href="../reference/global_local.html">set_local</a></span>(<span class="st">"item_pos"</span>, 1L, state)),</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="kw"><a href="../reference/while_loop.html">while_loop</a></span>(</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="dt">test =</span> <span class="cf">function</span>(state, ...) <span class="kw"><a href="../reference/global_local.html">get_local</a></span>(<span class="st">"item_pos"</span>, state) <span class="op">&lt;=</span><span class="st"> </span>num_items,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    <span class="dt">logic =</span> <span class="kw"><a href="../reference/reactive_page.html">reactive_page</a></span>(<span class="cf">function</span>(state, ...) {</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">      item_pos &lt;-<span class="st"> </span><span class="kw"><a href="../reference/global_local.html">get_local</a></span>(<span class="st">"item_pos"</span>, state)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">      item_id &lt;-<span class="st"> </span><span class="kw"><a href="../reference/global_local.html">get_local</a></span>(<span class="st">"item_order"</span>, state)[item_pos]</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">      <span class="kw">item</span>(<span class="dt">id =</span> items<span class="op">$</span>id[item_id], <span class="dt">prompt =</span> items<span class="op">$</span>prompt[item_id])</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    }))</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">)</a></code></pre></div>
<p>Finally, we can put together the whole test by combining three elements:</p>
<ol style="list-style-type: decimal">
<li>The logic for item randomisation (<code>init_randomiser</code>);</li>
<li>The logic for showing items (<code>show_items</code>);</li>
<li>A prebuilt test element that saves the results to disk (<code>elt_save_results_to_disk</code>);</li>
<li>A final page to terminate the test (<code>final_page</code>).</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/make_test.html">make_test</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  init_randomiser,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  show_items,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="kw"><a href="../reference/elt_save_results_to_disk.html">elt_save_results_to_disk</a></span>(<span class="dt">complete =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="kw"><a href="../reference/final_page.html">final_page</a></span>(<span class="st">"You completed the test."</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">))</a></code></pre></div>
<p>This code should launch the test, complete with randomisation.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> Results will be saved in the <code>output/results</code> directory.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p> A <em>tibble</em> is a nicely formatted version of a data frame, provide by the <em>tibble</em> package and exported by the <em>tidyverse</em> package.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p> In RStudio, this means running the code with the ‘Run’ button, not the ‘Source’ button. You can use ‘Source’ but then you have to wrap the code in <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html">shiny::runApp</a></code>.<a href="#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#tutorial">Tutorial</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter M. C. Harrison.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
